Name:           snx-rs
Version:        {{version}}
Release:        1%{?dist}
Summary:        SNX-RS Check Point VPN Client for Linux

License:        AGPL-3.0-or-later
URL:            https://github.com/ancwrd1/snx-rs
BuildArch:      {{arch}}

Requires:       glibc >= 2.35
Requires:       libgtk-4.so.1()(64bit)

%description
Unofficial Linux client for Check Point VPN, written in Rust.

%prep
# No prep needed, files are already in BUILDROOT

%build
# No build needed, binaries are pre-built

%install
cp -a $RPM_BUILDROOT/* %{buildroot}/

%files
/usr/bin/snx-rs
/usr/bin/snx-rs-gui
/usr/bin/snxctl
/etc/systemd/system/snx-rs.service
/usr/share/applications/snx-rs-gui.desktop

%pre
case "$1" in
    1)
        # Fresh install
        ;;
    2)
        # Upgrade
        systemctl stop snx-rs 2>/dev/null >/dev/null || true
        pkill snx-rs-gui 2>/dev/null >/dev/null || true
        ;;
esac
exit 0

%post
case "$1" in
    1)
        # Fresh install
        systemctl enable --now snx-rs 2>/dev/null >/dev/null || true
        ;;
    2)
        # Upgrade
        systemctl start snx-rs 2>/dev/null >/dev/null || true
        ;;
esac
exit 0

%preun
case "$1" in
    0)
        # Uninstall (not upgrade)
        systemctl disable --now snx-rs 2>/dev/null >/dev/null || true
        pkill snx-rs-gui 2>/dev/null >/dev/null || true
        ;;
    1)
        # Upgrade
        ;;
esac
exit 0

%postun
case "$1" in
    0)
        # Uninstall
        rm -rf /var/cache/snx-rs
        rm -f /etc/systemd/system/snx-rs.service 2>/dev/null >/dev/null || true
        systemctl daemon-reload
        ;;
    1)
        # Upgrade
        ;;
esac
exit 0
